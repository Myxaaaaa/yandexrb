<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="MobileOptimized" content="176">
    <meta name="HandheldFriendly" content="True">
    <meta name="robots" content="noindex,nofollow">
    <title>Яндекс Самокаты</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="theme.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            /* Light theme variables (default) */
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --text-primary: #333333;
            --text-secondary: #666666;
            --card-bg: #ffffff;
            --card-border: #e0e0e0;
            --button-primary-bg: #ffcc00;
            --button-primary-text: #000000;
            --button-secondary-bg: #f0f0f0;
            --button-secondary-text: #333333;
            --info-card-bg: #ffffff;
            --info-card-border: #e0e0e0;
            --summary-bg: #f8f8f8;
            --history-bg: #ffffff;
            --history-border: #e0e0e0;
        }

        /* Dark theme variables */
        [data-theme="dark"] {
            --bg-primary: #1f1f1f;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --card-bg: #2d2d2d;
            --card-border: #404040;
            --button-primary-bg: #ffcc00;
            --button-primary-text: #000000;
            --button-secondary-bg: #404040;
            --button-secondary-text: #ffffff;
            --info-card-bg: #2d2d2d;
            --info-card-border: #404040;
            --summary-bg: #2d2d2d;
            --history-bg: #2d2d2d;
            --history-border: #404040;
        }

        /* Apply theme colors */
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .app-container {
            background-color: var(--bg-primary);
        }

        .app-header {
            background-color: var(--bg-secondary);
        }

        .parking-card {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
        }

        .card-header h3 {
            color: var(--text-primary);
        }

        .btn.primary {
            background-color: var(--button-primary-bg);
            color: var(--button-primary-text);
        }

        .btn.secondary {
            background-color: var(--button-secondary-bg);
            color: var(--button-secondary-text);
        }

        .info-card {
            background-color: var(--info-card-bg);
            border: 1px solid var(--info-card-border);
        }

        .info-label {
            color: var(--text-secondary);
        }

        .info-value {
            color: var(--text-primary);
        }

        .shift-summary {
            background-color: var(--summary-bg);
            border: 1px solid var(--card-border);
        }

        .shift-history {
            background-color: var(--history-bg);
            border: 1px solid var(--history-border);
            color: var(--text-primary);
        }

        .history-total {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .history-total h3 {
            color: var(--text-primary);
            margin: 0 0 10px 0;
        }

        .history-total p {
            color: var(--text-secondary);
            margin: 5px 0;
        }

        .history-list {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 15px;
        }

        .history-item {
            background-color: var(--info-card-bg);
            border: 1px solid var(--info-card-border);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-item .date {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .history-item .earnings {
            color: var(--text-primary);
            font-weight: 500;
        }

        .parking-tab {
            background-color: var(--button-secondary-bg);
            color: var(--button-secondary-text);
        }

        .parking-tab.active {
            background-color: var(--button-primary-bg);
            color: var(--button-primary-text);
        }

        .scooter-type {
            color: var(--text-secondary);
        }

        .count {
            color: var(--text-primary);
        }

        .counter-btn {
            background-color: var(--button-secondary-bg);
            color: var(--button-secondary-text);
        }

        /* Fallback icons with theme support */
        .icon-fallback {
            display: inline-block;
            width: 18px;
            height: 18px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .icon-play { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffcc00"><path d="M8 5v14l11-7z"/></svg>'); }
        .icon-stop { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffcc00"><path d="M6 6h12v12H6z"/></svg>'); }
        .icon-clock { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23b0b0b0"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>'); }
        .icon-scooter { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23b0b0b0"><path d="M19 7c0-1.1-.9-2-2-2h-3v2h3v2.65L13.52 14H10V9H6c-2.21 0-4 1.79-4 4v3h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4.48L19 10.35V7zM7 17c-.55 0-1-.45-1-1h2c0 .55-.45 1-1 1z"/><path d="M10 6H5c-.55 0-1 .45-1 1v2h2V7h5V6z"/><path d="M19 13c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zm0 4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/></svg>'); }
        .icon-money { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23b0b0b0"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>'); }
        .icon-check { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23b0b0b0"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>'); }

        [data-theme="dark"] .icon-clock,
        [data-theme="dark"] .icon-scooter,
        [data-theme="dark"] .icon-money,
        [data-theme="dark"] .icon-check {
            filter: brightness(0.8);
        }

        body {
          background: var(--tg-theme-bg-color);
          color: var(--tg-theme-text-color);
        }

        .card, .parking-card, .repairs-section, .repair-number,
        .report-modal, .shift-report, .modal, .popup, .dropdown-menu {
          background: var(--tg-theme-secondary-bg-color, var(--tg-theme-bg-color));
          color: var(--tg-theme-text-color);
          border: 1px solid var(--tg-theme-hint-color);
        }

        button, .btn, .repair-actions button {
          background: var(--tg-theme-button-color);
          color: var(--tg-theme-button-text-color);
          border: none;
          border-radius: 8px;
          padding: 8px 16px;
          margin: 4px;
          cursor: pointer;
          font-size: 1em;
          transition: background 0.2s, color 0.2s;
        }

        button:hover, .btn:hover {
          filter: brightness(1.1);
        }

        input, .repair-input, select, textarea {
          background: var(--tg-theme-bg-color);
          color: var(--tg-theme-text-color);
          border: 1px solid var(--tg-theme-hint-color);
          border-radius: 6px;
          padding: 6px 10px;
          margin: 4px 0;
          transition: background 0.3s, color 0.3s, border 0.3s;
        }

        a {
          color: var(--tg-theme-link-color);
          text-decoration: none;
          transition: color 0.2s;
        }
        a:hover {
          filter: brightness(1.2);
        }

        .repairing-count { color: var(--tg-theme-link-color); }
        .fixed-count { color: var(--tg-theme-button-color); }
        .warehouse-count { color: var(--tg-theme-destructive-text-color); }

        .repair-number.repairing { border-left: 4px solid var(--tg-theme-link-color); }
        .repair-number.fixed { border-left: 4px solid var(--tg-theme-button-color); }
        .repair-number.warehouse { border-left: 4px solid var(--tg-theme-destructive-text-color); }
    </style>
</head>
<body>
    <!-- <button class="toggle-theme-btn" id="toggleThemeBtn" title="Переключить тему">🌙</button> -->
    <div class="splash-screen">
        <div class="logo-container">
            <img src="https://uploads-ssl.webflow.com/639049bb07672b7215e252fc/639210d666f0ec806710bdf9_OxxxxG.jpg" alt="Yandex Logo" class="logo">
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <div class="main-content">
            <header class="app-header">
                <div class="header-content">
                    <h1>Управление самокатами</h1>
                    
                    <div class="shift-controls">
                        <button id="startShift" class="btn primary">
                            <i class="fas fa-play btn-icon"></i>
                            <span class="icon-fallback icon-play"></span>
                            На линию
                        </button>
                        <button id="endShift" class="btn secondary" disabled>
                            <i class="fas fa-stop btn-icon"></i>
                            <span class="icon-fallback icon-stop"></span>
                            Выйти с линии
                        </button>
                    </div>
                    
                    <div class="shift-info">
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="info-content">
                                <span class="info-label">Длительность смены</span>
                                <span id="shiftTimer" class="info-value">00:00:00</span>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-scooter"></i>
                            </div>
                            <div class="info-content">
                                <span class="info-label">Всего самокатов</span>
                                <span id="totalScooters" class="info-value">0</span>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="info-content">
                                <span class="info-label">Текущая ставка</span>
                                <span id="currentRate" class="info-value">100</span>
                                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Kyrgyzstan.svg" alt="KGS" class="currency-flag">
                                <span class="rate-unit">/ч</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div id="activeShiftEarnings" class="active-shift-earnings" style="display: none;">
                <div class="earnings-content">
                    <div class="earnings-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="earnings-info">
                        <span class="earnings-label">Заработок за текущую смену</span>
                        <span id="activeEarnings" class="earnings-value">0.00</span>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Kyrgyzstan.svg" alt="KGS" class="currency-flag">
                    </div>
                </div>
            </div>

            <div class="parking-selector">
                <button class="parking-tab" data-parking="beta">Бета</button>
                <button class="parking-tab" data-parking="gum">ГУМ</button>
                <button class="parking-tab" data-parking="vefa">Вефа</button>
                <button class="parking-tab" data-parking="medical">Медицинская Академия</button>
                <button class="parking-tab" data-parking="polytech">Политех</button>
                <button class="parking-tab" data-parking="yuzhka">Южка</button>
                <!-- <button class="parking-tab" data-parking="replacements">Замены</button> -->
                <button class="parking-tab" data-parking="repairs">Исправления и замены</button>
            </div>

            <div class="parking-grid">
                <div id="beta" class="parking-card">
                    <div class="card-header">
                        <h3>Бета</h3>
                        <button class="select-parking">
                            <i class="fas fa-check"></i> Выбрать
                        </button>
                    </div>
                    <div class="scooter-counter">
                        <div class="counter-group yandex">
                            <span class="scooter-type">Yandex</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count yandex-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                        <div class="counter-group sunrent">
                            <span class="scooter-type">SunRent</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count sunrent-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="gum" class="parking-card">
                    <div class="card-header">
                        <h3>ГУМ</h3>
                        <button class="select-parking">
                            <i class="fas fa-check"></i> Выбрать
                        </button>
                    </div>
                    <div class="scooter-counter">
                        <div class="counter-group yandex">
                            <span class="scooter-type">Yandex</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count yandex-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                        <div class="counter-group sunrent">
                            <span class="scooter-type">SunRent</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count sunrent-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="vefa" class="parking-card">
                    <div class="card-header">
                        <h3>Вефа</h3>
                        <button class="select-parking">
                            <i class="fas fa-check"></i> Выбрать
                        </button>
                    </div>
                    <div class="scooter-counter">
                        <div class="counter-group yandex">
                            <span class="scooter-type">Yandex</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count yandex-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                        <div class="counter-group sunrent">
                            <span class="scooter-type">SunRent</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count sunrent-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="medical" class="parking-card">
                    <div class="card-header">
                        <h3>Медицинская Академия</h3>
                        <button class="select-parking">
                            <i class="fas fa-check"></i> Выбрать
                        </button>
                    </div>
                    <div class="scooter-counter">
                        <div class="counter-group yandex">
                            <span class="scooter-type">Yandex</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count yandex-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                        <div class="counter-group sunrent">
                            <span class="scooter-type">SunRent</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count sunrent-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="polytech" class="parking-card">
                    <div class="card-header">
                        <h3>Политех</h3>
                        <button class="select-parking">
                            <i class="fas fa-check"></i> Выбрать
                        </button>
                    </div>
                    <div class="scooter-counter">
                        <div class="counter-group yandex">
                            <span class="scooter-type">Yandex</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count yandex-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                        <div class="counter-group sunrent">
                            <span class="scooter-type">SunRent</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count sunrent-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="yuzhka" class="parking-card">
                    <div class="card-header">
                        <h3>Южка</h3>
                        <button class="select-parking">
                            <i class="fas fa-check"></i> Выбрать
                        </button>
                    </div>
                    <div class="scooter-counter">
                        <div class="counter-group yandex">
                            <span class="scooter-type">Yandex</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count yandex-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                        <div class="counter-group sunrent">
                            <span class="scooter-type">SunRent</span>
                            <div class="counter-controls">
                                <button class="counter-btn minus">-</button>
                                <span class="count sunrent-count">0</span>
                                <button class="counter-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="replacements" class="parking-card">
                    <div class="card-header">
                        <h3>Замены самокатов</h3>
                    </div>
                    <div class="replacements-container">
                        <div class="replacement-section">
                            <h4>Yandex</h4>
                            <div class="replacement-input-group">
                                <input type="text" id="yandexReplacementInput" class="replacement-input" placeholder="Номер самоката">
                                <input type="text" id="yandexReplacementComment" class="replacement-input" placeholder="Комментарий">
                                <button class="add-replacement-btn" data-type="yandex">
                                    <i class="fas fa-plus"></i> Добавить
                                </button>
                            </div>
                            <div id="yandexReplacementsList" class="replacement-list"></div>
                        </div>
                        <div class="replacement-section">
                            <h4>SunRent</h4>
                            <div class="replacement-input-group">
                                <input type="text" id="sunrentReplacementInput" class="replacement-input" placeholder="Номер самоката">
                                <input type="text" id="sunrentReplacementComment" class="replacement-input" placeholder="Комментарий">
                                <button class="add-replacement-btn" data-type="sunrent">
                                    <i class="fas fa-plus"></i> Добавить
                                </button>
                            </div>
                            <div id="sunrentReplacementsList" class="replacement-list"></div>
                        </div>
                    </div>
                </div>

                <div id="repairs" class="parking-card">
                    <div class="card-header">
                        <h3>Самокаты на исправлении</h3>
                    </div>
                    <div class="replacements-container">
                        <div class="replacement-section">
                            <h4>Yandex</h4>
                            <div class="repair-input-group">
                                <input type="text" id="yandexRepairInput" class="repair-input" placeholder="Введите номер самоката">
                                <button class="add-repair-btn" data-type="yandex">
                                    <i class="fas fa-tools"></i>
                                    Добавить на исправление
                                </button>
                            </div>
                            <div id="yandexRepairsList" class="repair-list"></div>
                        </div>
                        <div class="replacement-section">
                            <h4>SunRent</h4>
                            <div class="repair-input-group">
                                <input type="text" id="sunrentRepairInput" class="repair-input" placeholder="Введите номер самоката">
                                <button class="add-repair-btn" data-type="sunrent">
                                    <i class="fas fa-tools"></i>
                                    Добавить на исправление
                                </button>
                            </div>
                            <div id="sunrentRepairsList" class="repair-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="shift-summary" id="shiftSummary">
                <div class="summary-item">
                    <i class="fas fa-clock"></i>
                    <span id="shiftDuration">0 ч</span>
                </div>
                <div class="summary-item">
                    <i class="fas fa-money-bill-wave"></i>
                    <span id="currentEarnings">0.00</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Kyrgyzstan.svg" alt="KGS" class="currency-flag">
                </div>
                <div class="summary-item">
                    <i class="fas fa-scooter"></i>
                    <span id="totalScooters">0</span>
                </div>
                <div class="summary-item">
                    <i class="fas fa-coins"></i>
                    <span id="currentRate">100</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Kyrgyzstan.svg" alt="KGS" class="currency-flag">
                </div>
            </div>

            <div class="shift-history">
                <div class="history-total" id="historyTotal">
                    <h3>Общий итог</h3>
                    <p>Всего смен: <span id="totalShifts">0</span></p>
                    <p>Общий заработок: <span id="totalEarnings">0.00</span> <img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Kyrgyzstan.svg" alt="KGS" class="currency-flag"></p>
                </div>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Function to detect and apply theme
        function applyTheme() {
            const isDark = window.Telegram.WebApp.colorScheme === 'dark';
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
        }

        // Apply theme on load and when theme changes
        document.addEventListener('DOMContentLoaded', applyTheme);
        window.Telegram.WebApp.onEvent('themeChanged', applyTheme);
    </script>
</body>
</html>